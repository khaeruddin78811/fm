<!DOCTYPE html><html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>کدنویسی و نمایشگر</title>
  <style>
    :root {
      --bg: #121212;
      --fg: #e0e0e0;
      --btn: #1f1f1f;
      --highlight: #007bff;
    }
    [data-theme="light"] {
      --bg: #ffffff;
      --fg: #000000;
      --btn: #f0f0f0;
      --highlight: #007bff;
    }
    body {
      margin: 0;
      font-family: sans-serif;
      background: var(--bg);
      color: var(--fg);
    }
    header {
      background: var(--btn);
      padding: 0.5rem;
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      align-items: center;
      gap: 0.5rem;
    }
    header select,
    header button,
    header input[type="number"] {
      padding: 0.4rem;
      border: none;
      border-radius: 8px;
      background: var(--highlight);
      color: white;
    }
    #editor {
      display: flex;
      flex-direction: column;
      height: 50vh;
    }
    textarea {
      flex: 1;
      padding: 0.5rem;
      font-family: monospace;
      font-size: 1rem;
      border: none;
      outline: none;
      resize: none;
    }
    #viewer {
      height: 50vh;
      width: 100%;
      border: none;
      background: white;
    }
    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <header>
    <div>
      <select id="mode">
        <option value="html">HTML</option>
        <option value="css">CSS</option>
        <option value="js">JavaScript</option>
        <option value="multi">HTML/CSS/JS</option>
      </select>
      <input type="number" id="duration" value="62" min="10" max="90" title="مدت ویدیو (ثانیه)">
      <button onclick="runCode()">▶️ اجرا</button>
      <button onclick="downloadOutput()">📽️ دانلود خروجی</button>
      <button onclick="toggleTheme()">🌓 تم شب/روز</button>
    </div>
  </header>  <div id="editor">
    <textarea id="html" placeholder="HTML بنویسید..."></textarea>
    <textarea id="css" class="hidden" placeholder="CSS بنویسید..."></textarea>
    <textarea id="js" class="hidden" placeholder="JavaScript بنویسید..."></textarea>
  </div>  <iframe id="viewer"></iframe>  <script>
    const modeSelect = document.getElementById("mode");
    const htmlArea = document.getElementById("html");
    const cssArea = document.getElementById("css");
    const jsArea = document.getElementById("js");
    const viewer = document.getElementById("viewer");

    modeSelect.addEventListener("change", () => {
      htmlArea.classList.remove("hidden");
      cssArea.classList.remove("hidden");
      jsArea.classList.remove("hidden");
      const mode = modeSelect.value;
      if (mode === "html") {
        cssArea.classList.add("hidden");
        jsArea.classList.add("hidden");
      } else if (mode === "css") {
        htmlArea.classList.add("hidden");
        jsArea.classList.add("hidden");
      } else if (mode === "js") {
        htmlArea.classList.add("hidden");
        cssArea.classList.add("hidden");
      }
    });

    function runCode() {
      const html = htmlArea.value;
      const css = cssArea.value;
      const js = jsArea.value;
      const mode = modeSelect.value;
      let code = "";
      if (mode === "html") {
        code = html;
      } else if (mode === "css") {
        code = `<style>${css}</style>`;} else if (mode === "js") {
    code = `<script>${js}<\/script>`;
  } else {
    code = `<!DOCTYPE html><html><head><style>${css}</style></head><body>${html}<script>${js}<\/script></body></html>`;
  }
  viewer.srcdoc = code;
}

function toggleTheme() {
  const root = document.documentElement;
  const current = root.getAttribute("data-theme");
  root.setAttribute("data-theme", current === "light" ? "dark" : "light");
}

async function downloadOutput() {
  const duration = Math.min(90, Math.max(10, parseInt(document.getElementById("duration").value) || 62));
  const iframe = document.getElementById("viewer");
  try {
    const stream = await navigator.mediaDevices.getDisplayMedia({ video: { frameRate: 30 } });
    const mediaRecorder = new MediaRecorder(stream);
    const chunks = [];

    mediaRecorder.ondataavailable = e => chunks.push(e.data);
    mediaRecorder.onstop = () => {
      const blob = new Blob(chunks, { type: 'video/mp4' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "output.mp4";
      a.click();
      URL.revokeObjectURL(url);
    };

    mediaRecorder.start();
    setTimeout(() => {
      mediaRecorder.stop();
      stream.getTracks().forEach(track => track.stop());
    }, duration * 1000);
  } catch (err) {
    alert("خطا در ضبط نمایشگر: " + err.message);
  }
}

  </script>
</body>
</html>
